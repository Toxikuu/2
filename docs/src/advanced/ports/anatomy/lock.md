# Lock

## Abstract
This page explains how `$PORT/LOCK` is formed and works.

### Formation
Locks are formed whenever a port is generated by 2lkit. Generally, you'd add a
port with `2lkit -a` and fill out `$PORT/BUILD`. `$PORT/LOCK` will be
automatically generated after exiting the editor.

Locks are generated by sourcing `$PORT/BUILD` with bash and recording data to a
struct which is serialized to `$PORT/LOCK`. In addition to metadata, sources are
downloaded, hashed, and recorded.

### Fields
Below is the lock for `main/yajl`.

```toml
repo = "main"
name = "yajl"
version = "2.1.0"
description = "Yet another json library"
timestamp = "2025-03-31 23:45:22"
dependencies = ["cmake"]
upstream = "https://github.com/lloyd/yajl.git"

[source]
url = "https://github.com/lloyd/yajl/archive/refs/tags/2.1.0.tar.gz"
hash = "P7czZKWjDv5hUEbQfm250J_StBx2PF99O_sSHNXFrFo"

[[extra]]
url = "https://gitlab.archlinux.org/archlinux/packaging/packages/yajl/-/raw/main/yajl-2.1.0-CVE-2017-16516.patch"
hash = "tetgF4Bx4t8AiIVpOfq71Fhk2DYlm2ESYPxJijQVRhQ"

[[extra]]
url = "https://gitlab.archlinux.org/archlinux/packaging/packages/yajl/-/raw/main/yajl-2.1.0-CVE-2022-24795.patch"
hash = "pY9RhxqevYCEnIvHQY329Y1m-P5wH14RpkKf0PMtns8"

[[extra]]
url = "https://gitlab.archlinux.org/archlinux/packaging/packages/yajl/-/raw/main/yajl-2.1.0-memory_leak.patch"
hash = "zTb39RUguqwr2EZ9e7sE8sbiYZaJgaHowQ_07XoK_2k"

[[extra]]
url = "https://github.com/lloyd/yajl/commit/6fe59ca50dfd65bdb3d1c87a27245b2dd1a072f9.patch"
hash = "2RsW5WoibbYW1Ktu9cEThMEUON1vaq2TO7p06Sch3Vs"
```

The fields should be fairly self-explanatory, excepting the hashes. The hashes
are url-safe base64-encoded sha256sums. Though 2 handles these automatically and
you *should* never have to deal with them, these hashes can be manually
generated like so:
```
 $ openssl dgst -sha256 -binary 6fe59ca50dfd65bdb3d1c87a27245b2dd1a072f9.patch | openssl base64 | tr -d '=' | tr '/+' '_-'
2RsW5WoibbYW1Ktu9cEThMEUON1vaq2TO7p06Sch3Vs

 $ openssl dgst -sha256 -binary yajl-2.1.0-memory_leak.patch | openssl base64 | tr -d '=' | tr '/+' '_-'
zTb39RUguqwr2EZ9e7sE8sbiYZaJgaHowQ_07XoK_2k
```
